import os\nimport base64\nimport json\nimport google.auth\nfrom google.auth.transport.requests import Request\nfrom google.oauth2.credentials import Credentials\nfrom google_auth_oauthlib.flow import InstalledAppFlow\nfrom googleapiclient.discovery import build\n\nSCOPES = ['https://www.googleapis.com/auth/gmail.readonly', 'https://www.googleapis.com/auth/gmail.modify', 'https://www.googleapis.com/auth/gmail.labels']\n\nclass GmailClient:\n    def __init__(self):\n        self.creds = None\n        self.service = None\n        self.authenticate()\n\n    def authenticate(self):\n        # Load credentials from token.json if it exists, otherwise go through OAuth flow\n        if os.path.exists('token.json'):\n            self.creds = Credentials.from_authorized_user_file('token.json', SCOPES)\n        else:\n            flow = InstalledAppFlow.from_client_secrets_file('credentials.json', SCOPES)\n            self.creds = flow.run_local_server(port=0)\n            # Save the credentials for the next run\n            with open('token.json', 'w') as token:  # Save the token for future use\n                token.write(self.creds.to_json())\n\n        # Make sure the credentials are valid\n        if self.creds and self.creds.expired and self.creds.refresh_token:\n            self.creds.refresh(Request())\n\n        self.service = build('gmail', 'v1', credentials=self.creds)\n\n    def fetch_emails(self, query=''):\n        results = self.service.users().messages().list(userId='me', q=query).execute()\n        messages = results.get('messages', [])\n        email_data = []\n\n        for msg in messages:\n            msg_data = self.service.users().messages().get(userId='me', id=msg['id']).execute()\n            email_data.append(msg_data)\n\n        return email_data\n\n    def manage_labels(self, operation, label_id, label_object=None):\n        if operation == 'create':\n            self.service.users().labels().create(userId='me', body=label_object).execute()\n        elif operation == 'delete':\n            self.service.users().labels().delete(userId='me', id=label_id).execute()\n        elif operation == 'update':\n            self.service.users().labels().update(userId='me', id=label_id, body=label_object).execute()\n        elif operation == 'get':\n            return self.service.users().labels().list(userId='me').execute()\n\n    def modify_message(self, msg_id, labels_to_add=[], labels_to_remove=[]):\n        self.service.users().messages().modify(userId='me', id=msg_id, body={'addLabelIds': labels_to_add, 'removeLabelIds': labels_to_remove}).execute()\n\nif __name__ == '__main__':\n    client = GmailClient()\n    # Example usage: Fetch emails with a specific query\n    emails = client.fetch_emails('from:example@gmail.com')\n    print(emails)\n